<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Location Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <nav class="nav-glass">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Emergency<span class="brand-highlight">Track</span></span>
            </div>
            <div class="nav-links">
                <a href="#home" class="nav-link active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="reliefnet/index.html" class="nav-link">
                    <i class="fas fa-hands-helping"></i>
                    <span>ReliefNet</span>
                </a>
                <a href="#emergency" class="nav-link emergency-link">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Emergency</span>
                </a>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <div class="bg-decoration">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <div class="header">
        <div class="header-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h1>Emergency Location Tracker</h1>
        <p>Send your location to emergency contacts in one click</p>
    </div>

    <div class="main-content">
        <div class="help-section">
            <button id="helpButton" class="help-button">
                <i class="fas fa-map-marker-alt"></i>
                I Need Help!
            </button>
            <div id="status" class="status">
                Click the button above to share your location for emergency assistance
            </div>
        </div>

        <div id="mapContainer" class="card map-container">
            <div id="map"></div>
        </div>

        <div id="coordinatesDisplay" class="card coordinates-display">
            <h3>
                <i class="fas fa-crosshairs"></i>
                Your Exact Location
            </h3>
            <div id="coordinates"></div>
        </div>

        <div class="card emergency-info">
            <h3>
                <i class="fas fa-phone-alt"></i>
                Emergency Contacts
            </h3>
            <div class="emergency-contacts">
                <div class="contact-item">
                    <span class="contact-label">Emergency Services</span>
                    <span class="contact-number">112</span>
                </div>
                <div class="contact-item">
                    <span class="contact-label">Police</span>
                    <span class="contact-number">100</span>
                </div>
                <div class="contact-item">
                    <span class="contact-label">Fire Department</span>
                    <span class="contact-number">101</span>
                </div>
                <div class="contact-item">
                    <span class="contact-label">Medical Emergency</span>
                    <span class="contact-number">108</span>
                </div>
                <div class="contact-item">
                    <span class="contact-label">Women's Helpline</span>
                    <span class="contact-number">1091</span>
                </div>
            </div>
        </div>
    </div>
    <button class="ai-chat-button" id="aiChatButton" title="AI Help">
        <i class="fas fa-robot"></i>
    </button>

    <div class="ai-chat-container" id="aiChatContainer">
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                <i class="fas fa-robot"></i> AI Emergency Assistant
            </div>
            <button class="ai-chat-close" id="aiChatClose">Ã—</button>
        </div>
        <div class="ai-chat-messages" id="aiChatMessages">
            <div class="ai-message assistant">
                Hello! I'm your AI Emergency Assistant. How can I help you with your current situation?
            </div>
        </div>
        <div class="ai-chat-input-container">
            <input type="text" class="ai-chat-input" id="aiChatInput" placeholder="Type your message..."
                maxlength="500">
            <button class="ai-chat-send" id="aiChatSend">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map = null;
        let marker = null;
        let userLocation = null;

        const helpButton = document.getElementById('helpButton');
        const status = document.getElementById('status');
        const mapContainer = document.getElementById('mapContainer');
        const coordinatesDisplay = document.getElementById('coordinatesDisplay');
        const coordinates = document.getElementById('coordinates');

        // Navigation functionality
        const navToggle = document.querySelector('.nav-toggle');
        const navLinks = document.querySelector('.nav-links');

        navToggle.addEventListener('click', () => {
            navToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
        });

        // Smooth scroll for navigation links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function () {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                if (window.innerWidth <= 768) {
                    navToggle.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        });

        function updateStatus(message, type = '') {
            status.className = `status ${type}`;
            status.innerHTML = message;
        }

        function initializeMap(lat, lng) {
            if (map) {
                map.remove();
            }

            map = L.map('map').setView([lat, lng], 16);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // Create custom emergency marker with enhanced styling
            const emergencyIcon = L.divIcon({
                className: 'emergency-marker',
                html: `
                    <div style="
                        background: linear-gradient(135deg, #ff4757 0%, #c44569 100%);
                        border: 4px solid white;
                        border-radius: 50%;
                        width: 32px;
                        height: 32px;
                        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.6);
                        animation: emergency-pulse 2s infinite;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 16px;
                    ">
                        !
                    </div>
                `,
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            });

            marker = L.marker([lat, lng], { icon: emergencyIcon }).addTo(map);

            // Add enhanced pulsing animation
            if (!document.getElementById('emergency-animations')) {
                const style = document.createElement('style');
                style.id = 'emergency-animations';
                style.textContent = `
                    @keyframes emergency-pulse {
                        0% { transform: scale(1); }
                        25% { transform: scale(1.2); box-shadow: 0 4px 20px rgba(255, 71, 87, 0.8); }
                        50% { transform: scale(1.4); box-shadow: 0 4px 25px rgba(255, 71, 87, 1); }
                        75% { transform: scale(1.2); box-shadow: 0 4px 20px rgba(255, 71, 87, 0.8); }
                        100% { transform: scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }

            // Enhanced popup
            marker.bindPopup(`
                <div style="text-align: center; font-weight: bold; color: #ff4757; padding: 10px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 20px; margin-bottom: 8px;"></i><br>
                    ðŸ†˜ EMERGENCY LOCATION<br>
                    <div style="font-size: 12px; color: #666; margin-top: 8px;">
                        Lat: ${lat.toFixed(6)}<br>
                        Lng: ${lng.toFixed(6)}
                    </div>
                </div>
            `).openPopup();

            // Enhanced accuracy circle with gradient
            L.circle([lat, lng], {
                color: '#ff4757',
                fillColor: '#ff4757',
                fillOpacity: 0.15,
                radius: 50,
                weight: 2,
                dashArray: '5, 5'
            }).addTo(map);
        }

        function displayCoordinates(lat, lng, accuracy) {
            const now = new Date();
            const googleMapsUrl = `https://maps.google.com/?q=${lat},${lng}`;

            coordinates.innerHTML = `
                <div class="coordinate-item">
                    <span class="coordinate-label">Latitude:</span>
                    <span class="coordinate-value">${lat.toFixed(6)}</span>
                </div>
                <div class="coordinate-item">
                    <span class="coordinate-label">Longitude:</span>
                    <span class="coordinate-value">${lng.toFixed(6)}</span>
                </div>
                <div class="coordinate-item">
                    <span class="coordinate-label">Accuracy:</span>
                    <span class="coordinate-value">Â±${Math.round(accuracy)}m</span>
                </div>
                <div class="coordinate-item">
                    <span class="coordinate-label">Timestamp:</span>
                    <span class="coordinate-value">${now.toLocaleString()}</span>
                </div>
                <div class="coordinate-item">
                    <span class="coordinate-label">Open in Maps:</span>
                    <a href="${googleMapsUrl}" target="_blank" class="maps-link">
                        <i class="fas fa-external-link-alt"></i>
                        Google Maps
                    </a>
                </div>
            `;
            coordinatesDisplay.style.display = 'block';
        }

        function getLocationSuccess(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            userLocation = { lat, lng, accuracy };

            updateStatus(`
                <i class="fas fa-check-circle"></i>
                Location found! Your exact position has been marked and emergency services can now locate you.
            `, 'success');

            initializeMap(lat, lng);
            displayCoordinates(lat, lng, accuracy);
            mapContainer.style.display = 'block';

            helpButton.disabled = false;
            helpButton.innerHTML = '<i class="fas fa-sync-alt"></i> Update My Location';
            helpButton.classList.remove('pulse-animation');

            // Simulate emergency alert with enhanced feedback
            setTimeout(() => {
                updateStatus(`
                    <i class="fas fa-ambulance"></i>
                   YOUR CURRENT LOCATION HAS BEEN SENT TO {emergency contacts}
                `, 'success');

                // Add success sound effect simulation
                if (window.AudioContext || window.webkitAudioContext) {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                    } catch (e) {
                        // Audio not supported or blocked
                    }
                }
            }, 2500);
        }

        function getLocationError(error) {
            let errorMessage = '';
            let icon = 'fas fa-exclamation-triangle';

            switch (error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'Location access denied. Please enable location permissions and try again.';
                    icon = 'fas fa-lock';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'Location information is unavailable. Please check your GPS settings.';
                    icon = 'fas fa-satellite-dish';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'Location request timed out. Please try again.';
                    icon = 'fas fa-clock';
                    break;
                default:
                    errorMessage = 'An unknown error occurred. Please try again.';
                    break;
            }

            updateStatus(`<i class="${icon}"></i> ${errorMessage}`, 'error');
            helpButton.disabled = false;
            helpButton.innerHTML = '<i class="fas fa-redo"></i> Try Again';
            helpButton.classList.remove('pulse-animation');
        }

        function requestHelp() {
            if (!navigator.geolocation) {
                updateStatus('<i class="fas fa-times-circle"></i> Geolocation is not supported by this browser.', 'error');
                return;
            }

            helpButton.disabled = true;
            helpButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Locating...';
            helpButton.classList.add('pulse-animation');

            updateStatus(`
                <span class="loading-spinner"></span>
                Getting your exact location for emergency services...
            `, 'loading');

            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 0
            };

            navigator.geolocation.getCurrentPosition(
                getLocationSuccess,
                getLocationError,
                options
            );
        }

        // Event listeners
        helpButton.addEventListener('click', requestHelp);

        // Enhanced page load behavior
        window.addEventListener('load', () => {
            helpButton.focus();

            // Add subtle entrance animations
            setTimeout(() => {
                helpButton.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    helpButton.style.transform = 'scale(1)';
                }, 200);
            }, 500);
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                if (document.activeElement === helpButton) {
                    e.preventDefault();
                    requestHelp();
                }
            }
        });
    </script>
    <script src="ai-chat.js"></script>
</body>

</html>